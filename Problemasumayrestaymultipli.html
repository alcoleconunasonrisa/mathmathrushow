<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Resolutor Pro - Matem√°ticas Completas</title>
    <style>
        :root {
            --primary: #00b4db;
            --secondary: #0077b6;
            --success: #43a047;
            --danger: #e53935;
            --warning: #fbc02d;
            --bg-card: #f8f9fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        
        .container {
            width: 98%; max-width: 1000px; height: 95vh;
            background: white; border-radius: 28px; padding: 1.2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; position: relative;
        }

        .instruccion {
            background: var(--secondary); color: white; padding: 12px;
            border-radius: 15px; text-align: center; margin-bottom: 0.8rem;
            font-weight: bold; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .contenido-juego { display: flex; flex: 1; gap: 1rem; overflow: hidden; }

        .pantalla { display: none; flex: 1.8; flex-direction: column; border-radius: 20px; background: var(--bg-card); padding: 1.5rem; overflow-y: auto; border: 2px solid #eee; }
        .pantalla.active { display: flex; }

        .btn-nivel { width: 100%; max-width: 300px; padding: 18px; margin: 10px; border: none; border-radius: 15px; color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; transition: 0.3s; box-shadow: 0 5px #777; }
        .btn-nivel:active { transform: translateY(3px); box-shadow: 0 2px #777; }

        .enunciado-box { 
            background: white; padding: 1.5rem; border-radius: 18px; 
            border-left: 8px solid var(--warning); margin-bottom: 1.2rem; 
            font-size: 1.25rem; line-height: 1.5; color: #333;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .avatar-icon { font-size: 3rem; display: block; margin-bottom: 10px; }
        .highlight-word { color: var(--secondary); font-weight: 800; }

        .fila-dato { display: flex; align-items: center; background: white; padding: 15px; border-radius: 18px; margin-bottom: 12px; border: 2px solid #eee; transition: 0.3s; }
        .etiqueta-dato { flex: 1; font-size: 1.1rem; color: #444; font-weight: 600; }

        .celda {
            width: 50px; height: 58px; border: 2px solid #ccc; border-radius: 12px;
            background: white; text-align: center; line-height: 54px;
            font-size: 2.2rem; font-weight: bold; transition: 0.2s;
        }
        .celda.activa { border: 3px solid var(--primary); background: #e0f7fa; transform: scale(1.08); }
        .celda.correcta { border-color: var(--success); color: var(--success); background: #e8f5e9; }
        .celda.incorrecta { border-color: var(--danger); background: #ffebee; color: var(--danger); animation: shake 0.4s; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

        .zona-teclado { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #fff; border-radius: 20px; border: 2px solid #eee; }
        .teclado { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; max-width: 280px; padding: 15px; }
        .tecla { padding: 18px 0; font-size: 1.6rem; border: none; border-radius: 18px; background: #f5f5f5; font-weight: bold; box-shadow: 0 5px #ccc; cursor: pointer; transition: 0.1s; }
        .tecla:active { transform: translateY(4px); box-shadow: 0 1px #ccc; }

        .tablero { font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: flex-end; font-size: 3.5rem; font-weight: bold; color: #222; }
        .fila-linea { border-bottom: 6px solid #333; width: 120%; margin: 10px 0; border-radius: 3px; }
        
        #caja-solucion { display: none; background: #e8f5e9; padding: 25px; border-radius: 20px; border: 3px solid var(--success); margin-top: 20px; text-align: center; }

        #modal-victoria { display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.98); z-index: 100; flex-direction: column; justify-content: center; align-items: center; border-radius: 28px; }

        @media (max-width: 768px) { .contenido-juego { flex-direction: column; } .zona-teclado { flex: 1.6; border-top: 5px solid var(--primary); } .tablero { font-size: 2.5rem; } }
    </style>
</head>
<body>

<div class="container">
    <div id="instruccion" class="instruccion">¬°Hola! Elige un nivel para practicar</div>
    
    <div id="pantalla-menu" class="pantalla active" style="justify-content: center; align-items: center; text-align: center;">
    <h1 style="color:var(--secondary); margin-bottom:25px; font-size: 2.5rem;">Aprende Problemas üöÄ</h1>
    
    <button class="btn-nivel" style="background:var(--success)" onclick="empezarJuego(1)">Nivel 1 (F√°cil)</button>
    <button class="btn-nivel" style="background:#fb8c00" onclick="empezarJuego(2)">Nivel 2 (Medio)</button>
    <button class="btn-nivel" style="background:var(--danger)" onclick="empezarJuego(3)">Nivel 3 (Dif√≠cil)</button>
    
    <hr style="width: 80%; margin: 20px auto; border: 0; border-top: 1px solid #ddd;">

    <button class="btn-nivel" style="background:#607d8b; max-width: 250px; font-size: 1rem; box-shadow: 0 5px #455a64;" 
            onclick="window.location.href='main-index.html'">
        üè† Volver al Inicio
    </button>
</div>
    <div id="pantalla-juego" class="contenido-juego" style="display:none;">
        <div id="vista-planteamiento" class="pantalla active">
            <div id="enunciado" class="enunciado-box"></div>
            
            <div class="fila-dato">
                <span id="label-d1" class="etiqueta-dato">Dato 1:</span>
                <div id="box-d1" style="display:flex; gap:8px"></div>
            </div>
            <div class="fila-dato">
                <span id="label-d2" class="etiqueta-dato">Dato 2:</span>
                <div id="box-d2" style="display:flex; gap:8px"></div>
            </div>
            
            <div id="area-op" style="margin-top:1.5rem; display:none;">
                <p style="margin-bottom:15px; font-weight:800; color:var(--secondary); text-align:center; font-size: 1.2rem;">¬øQU√â OPERACI√ìN NECESITAS?</p>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                    <button id="btn-suma" class="btn-nivel" style="background:var(--success); margin:0; max-width: none;" onclick="seleccionarOp('+')">SUMAR (+)</button>
                    <button id="btn-resta" class="btn-nivel" style="background:var(--danger); margin:0; max-width: none;" onclick="seleccionarOp('-')">RESTAR (-)</button>
                    <button id="btn-multi" class="btn-nivel" style="background:var(--primary); margin:0; max-width: none; grid-column: span 2;" onclick="seleccionarOp('x')">MULTIPLICAR (x)</button>
                </div>
                <div id="msg-error-op" style="display:none; color:var(--danger); padding:12px; background:#ffebee; margin-top:12px; border-radius:15px; text-align:center; font-weight:bold; border: 2px solid var(--danger);">‚ùå Esa operaci√≥n no resuelve este problema.</div>
            </div>
        </div>

        <div id="vista-calculo" class="pantalla">
            <div id="resumen-calculo" style="background:#e3f2fd; padding:15px; border-radius:15px; margin-bottom:1.5rem; text-align:center; font-weight:bold; color:var(--secondary); font-size: 1.2rem; border: 2px solid var(--primary);"></div>
            <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                <div class="tablero">
                    <div id="num1-tablero"></div>
                    <div id="num2-tablero"></div>
                    <div class="fila-linea"></div>
                    <div id="fila-resultado" style="display:flex; gap:10px"></div>
                </div>
                <div id="caja-solucion">
                    <h2 style="color:var(--success); font-size: 2rem; margin-bottom: 10px;">üåü ¬°LO LOGRASTE!</h2>
                    <p id="texto-solucion-final" style="font-size:1.3rem; font-weight:bold; margin:15px 0; color:#333;"></p>
                    <button class="btn-nivel" style="background:var(--success); width:auto; padding:12px 40px;" onclick="mostrarVictoria()">Continuar</button>
                </div>
            </div>
        </div>

        <div class="zona-teclado">
            <div class="teclado">
                <button class="tecla" onclick="inputNum(1)">1</button><button class="tecla" onclick="inputNum(2)">2</button><button class="tecla" onclick="inputNum(3)">3</button>
                <button class="tecla" onclick="inputNum(4)">4</button><button class="tecla" onclick="inputNum(5)">5</button><button class="tecla" onclick="inputNum(6)">6</button>
                <button class="tecla" onclick="inputNum(7)">7</button><button class="tecla" onclick="inputNum(8)">8</button><button class="tecla" onclick="inputNum(9)">9</button>
                <button class="tecla" style="background:#ffcdd2; color: #b71c1c;" onclick="borrar()">C</button><button class="tecla" onclick="inputNum(0)">0</button>
                <button class="tecla" style="background:#e1f5fe; color: #01579b;" onclick="irMenu()">üè†</button>
            </div>
        </div>
    </div>

    <div id="modal-victoria">
        <div style="font-size: 6rem; margin-bottom: 20px;">üèÜ</div>
        <h2 style="font-size: 2.8rem; color: var(--success); margin-bottom:25px; text-align:center;">¬°Genio matem√°tico!</h2>
        <button class="btn-nivel" style="background:var(--success)" onclick="empezarJuego(nivelActual)">Nuevo Problema</button>
        <button class="btn-nivel" style="background:var(--secondary)" onclick="irMenu()">Cambiar Nivel</button>
    </div>
</div>

<script>
    let nivelActual = 1, fase = "D1", PROBLEMA = {}, celdasActivas = [], subIndice = 0;

    const configProblemas = {
        nombres: ["Mar√≠a", "Lucas", "Emma", "Leo", "Sof√≠a", "Hugo", "Dani", "Carla"],
        temas: [
            { obj: "caramelo", plural: "caramelos", icono: "üç¨", vSuma: "le regalan", vResta: "se come", vMulti: "bolsas con", solSuma: "Ahora tiene X Y.", solResta: "Le quedan X Y.", solMulti: "Tiene un total de X Y." },
            { obj: "p√°jaro", plural: "p√°jaros", icono: "üê¶", vSuma: "vienen", vResta: "se escapan", vMulti: "√°rboles con", solSuma: "En total hay X Y.", solResta: "Quedan X Y.", solMulti: "Hay un total de X Y." },
            { obj: "euro", plural: "euros", icono: "üí∂", vSuma: "encuentra", vResta: "paga", vMulti: "huchas con", solSuma: "Tiene ahorrados X Y.", solResta: "Le sobran X Y.", solMulti: "Ha juntado X Y." },
            { obj: "manzana", plural: "manzanas", icono: "üçé", vSuma: "cosecha", vResta: "tira", vMulti: "cajas con", solSuma: "Tiene un total de X Y.", solResta: "Ahora tiene X Y.", solMulti: "Ha recogido X Y." }
        ]
    };

    function generarNumeros(cifras, tipo) {
        const min = Math.pow(10, cifras - 1);
        const max = Math.pow(10, cifras) - 1;
        let n1, n2;

        if (tipo === 'resta') {
            n1 = Math.floor(Math.random() * (max - min + 1)) + min;
            n2 = Math.floor(Math.random() * (n1 - 1)) + 1;
        } else if (tipo === 'multi') {
            n1 = Math.floor(Math.random() * (max - min + 1)) + min;
            n2 = (cifras === 1) ? (Math.floor(Math.random() * 8) + 2) : (Math.floor(Math.random() * 7) + 3);
        } else {
            n1 = Math.floor(Math.random() * (max - min + 1)) + min;
            n2 = Math.floor(Math.random() * (max - min + 1)) + min;
        }
        return [n1.toString(), n2.toString()];
    }

    function empezarJuego(n) {
        nivelActual = n; fase = "D1";
        document.getElementById('modal-victoria').style.display = "none";
        document.getElementById('pantalla-menu').style.display = "none";
        document.getElementById('pantalla-juego').style.display = "flex";
        document.getElementById('vista-planteamiento').style.display = "flex";
        document.getElementById('vista-calculo').style.display = "none";
        document.getElementById('area-op').style.display = "none";
        document.getElementById('caja-solucion').style.display = "none";
        document.getElementById('instruccion').textContent = "Paso 1: Extrae los n√∫meros del problema";
        
        const tipos = ['suma', 'resta', 'multi'];
        const tipo = tipos[Math.floor(Math.random() * tipos.length)];
        const tema = configProblemas.temas[Math.floor(Math.random() * configProblemas.temas.length)];
        const nombre = configProblemas.nombres[Math.floor(Math.random() * configProblemas.nombres.length)];
        const [v1, v2] = generarNumeros(n, tipo);
        
        let label1, label2, enunciado;
        
        if (tipo === 'suma') {
            label1 = "Tenia"; label2 = "Recibe";
            enunciado = `${nombre} ten√≠a <strong>${v1}</strong> ${tema.plural} y luego ${tema.vSuma} <strong>${v2}</strong> ${tema.plural} m√°s.`;
        } else if (tipo === 'resta') {
            label1 = "Tenia"; label2 = "Pierde";
            enunciado = `${nombre} ten√≠a <strong>${v1}</strong> ${tema.plural} y luego ${tema.vResta} <strong>${v2}</strong> de ellos.`;
        } else {
            label1 = "Cantidad"; label2 = "En cada uno";
            enunciado = `${nombre} tiene <strong>${v1}</strong> ${tema.vMulti} <strong>${v2}</strong> ${tema.plural} cada uno.`;
        }

        PROBLEMA = {
            n1: v1, n2: v2, op: (tipo==='suma' ? '+' : (tipo==='resta' ? '-' : 'x')),
            res: (tipo==='suma' ? parseInt(v1)+parseInt(v2) : (tipo==='resta' ? parseInt(v1)-parseInt(v2) : parseInt(v1)*parseInt(v2))).toString(),
            tema: tema, solTemplate: (tipo==='suma' ? tema.solSuma : (tipo==='resta' ? tema.solResta : tema.solMulti)), 
            nombreFinal: tema.plural
        };

        document.getElementById('enunciado').innerHTML = `<span class="avatar-icon">${tema.icono}</span>${enunciado}<br><br>¬øCu√°ntos hay al final?`;
        document.getElementById('label-d1').textContent = label1 + ":";
        document.getElementById('label-d2').textContent = label2 + ":";
        
        document.getElementById('box-d1').innerHTML = "";
        document.getElementById('box-d2').innerHTML = "";
        activarGrupo(crearCeldas('box-d1', PROBLEMA.n1));
    }

    function crearCeldas(id, val) {
        const cont = document.getElementById(id); const arr = [];
        for(let i=0; i<val.length; i++) {
            const c = document.createElement('div'); c.className = 'celda';
            cont.appendChild(c); arr.push(c);
        }
        return arr;
    }

    function activarGrupo(grupo) {
        celdasActivas = Array.from(grupo);
        subIndice = celdasActivas.length - 1;
        celdasActivas.forEach(c => { c.classList.remove('activa'); c.classList.remove('correcta'); });
        if(celdasActivas[subIndice]) celdasActivas[subIndice].classList.add('activa');
    }

    function inputNum(n) {
        if(fase === "OP" || fase === "FIN") return;
        let objetivo = (fase === "D1") ? PROBLEMA.n1 : (fase === "D2" ? PROBLEMA.n2 : PROBLEMA.res);
        let celda = celdasActivas[subIndice];

        if(n.toString() === objetivo[subIndice]) {
            celda.textContent = n; celda.className = 'celda correcta';
            subIndice--;
            if(subIndice >= 0) celdasActivas[subIndice].classList.add('activa');
            else avanzar();
        } else {
            celda.textContent = n; celda.classList.add('incorrecta');
            setTimeout(() => { celda.classList.remove('incorrecta'); celda.textContent = ""; }, 500);
        }
    }

    function avanzar() {
        if(fase === "D1") { fase = "D2"; activarGrupo(crearCeldas('box-d2', PROBLEMA.n2)); }
        else if(fase === "D2") { 
            fase = "OP"; 
            document.getElementById('area-op').style.display = "block"; 
            document.getElementById('instruccion').textContent = "Paso 2: ¬øQu√© operaci√≥n resuelve el problema?"; 
        }
        else if(fase === "CALC") {
            fase = "FIN";
            document.getElementById('caja-solucion').style.display = "block";
            let solText = PROBLEMA.solTemplate.replace("X", PROBLEMA.res).replace("Y", PROBLEMA.nombreFinal);
            document.getElementById('texto-solucion-final').textContent = solText;
            document.getElementById('instruccion').textContent = "¬°Perfecto! Has resuelto el problema.";
        }
    }

    function seleccionarOp(simbolo) {
        if(simbolo === PROBLEMA.op) {
            document.getElementById('vista-planteamiento').style.display = "none";
            document.getElementById('vista-calculo').style.display = "flex";
            document.getElementById('instruccion').textContent = "Paso 3: Realiza la operaci√≥n final";
            document.getElementById('num1-tablero').textContent = PROBLEMA.n1;
            document.getElementById('num2-tablero').textContent = (PROBLEMA.op === 'x' ? '√ó ' : PROBLEMA.op + ' ') + PROBLEMA.n2;
            document.getElementById('resumen-calculo').textContent = `OPERACI√ìN: ${PROBLEMA.n1} ${PROBLEMA.op} ${PROBLEMA.n2}`;
            
            fase = "CALC";
            const resCont = document.getElementById('fila-resultado'); resCont.innerHTML = "";
            activarGrupo(crearCeldas('fila-resultado', PROBLEMA.res));
        } else {
            document.getElementById('msg-error-op').style.display = "block";
            setTimeout(() => { document.getElementById('msg-error-op').style.display = "none"; }, 2500);
        }
    }

    function borrar() { if(celdasActivas[subIndice] && !celdasActivas[subIndice].classList.contains('correcta')) celdasActivas[subIndice].textContent = ""; }
    function mostrarVictoria() { document.getElementById('modal-victoria').style.display = "flex"; }
    function irMenu() { 
        document.getElementById('modal-victoria').style.display = "none"; 
        document.getElementById('pantalla-juego').style.display = "none"; 
        document.getElementById('pantalla-menu').style.display = "flex"; 
        document.getElementById('instruccion').textContent = "Elige un nivel para practicar"; 
    }
</script>
</body>
</html>
